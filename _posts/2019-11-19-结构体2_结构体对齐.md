---
title: C语言结构体对齐
date: 2019-11-19
categories: 
- C
tags: 
- C语言结构体对齐
- 反汇编
---

# 1.sizeof的使用（这是一个关键字）
	获取某个类型有多少字节
	
# 2.结构体对齐
	从小到大写最省空间
	vc6.0默认是8
	效率（本机尺寸）or空间（结构体）
	对齐参数
		结构体参数是由几字节对齐的：1 2 4 8
		如果这个值比结构体成员的sizeof值小，则该成员的偏移以该值为准，也即是说，该结构体成员的偏移量应取二者的最小值
		最后分配的字节，应该是对齐参数的整数倍
	1.数据成员对齐的规则，第一个数据从0开始，后续的成员要在每个成员的后面整数倍后开始（32位int4字节，则从4的整数倍卡存储）
		第一个值是int后一个是long，则int补齐
		char a;
		int b;
		a 0 0 0 
		b b b b
	2.结构体大小应是最大值的整数倍，不够则补齐,
	3.结构体内有结构则用结构体内最大的值对齐
		```
		#include <stdio.h>

		//#pragma pack(1)
		//#pragma pack(2)
		//#pragma pack(4)
		//#pragma pack(8)
		struct test {
			int a;
			__int64 b;
			char c;
		};//1 13字节

		struct test2 {
			int a;
			__int64 b;
			char c;
		};//2 14字节

		struct test3 {
			int a;
			__int64 b;
			char c;
		};//4 16字节

		struct test4 {
			int a;
			__int64 b;
			char c;
		};//8 24字节

		int main(void)
		{
			printf("%d",sizeof(test4));
			getchar();
			return 0;
		}
		```
```
	12 8
	#include <stdio.h>

	struct S1 {
		char a;
		int b;
		char c;
	};

	struct S2 {
		int a;
		char b;
		char c;
	};

	int main(void)
	{
		S1 s1;
		S2 s2;
		printf("%d\n%d\n",sizeof(s1),sizeof(s2));
		getchar();
	}
```

# typedef
	为现有的类型定义一个新的名称
```c
	#include <stdio.h>

	typedef unsigned char BYTE;
	typedef unsigned short WORD;
	typedef unsigned int DWORD;

	int main(void)
	{
		printf("%d",sizeof(DWORD));
		getchar();
		return 0;
	}
	
	typedef struct student {
		int x;
		int y;
	}stu;
```
# 结构体数组
```
```

作业：
-	1、定义一个结构体Monster，能够存储怪的各种信息（至少一个成员是结构体）
-	2、声明一个Monster类型的数组，长度为10
-	3、编写一个函数，为第二题的数组赋值
-	4、编写一个函数能够通过怪物ID，打印当前怪物的所有信息
-	5、分析下面结构统一的内存分配

```
	#include <stdio.h>

	struct s1{
		char c;
		double i;
	};
	struct s2{
		char c;
		double i;
	};
	struct s3{
		int c1;
		char c2[10];
	};
	struct s4{
		char c1;
		s1 s;
		char c2;
		char c3;
	};
	struct s5{
		char c1;
		s1 s;
		char c2;
		double c3;
	};

	int main(void)
	{
		printf("%d %d %d %d %d",sizeof(s1),sizeof(s2),sizeof(s3),sizeof(s4),sizeof(s5));
		getchar();
		return 0;
	}
```	

数组作为参数传递时候：
	