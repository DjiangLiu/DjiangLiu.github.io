---
title: PE导出表
date: 2020-1-13
categories: 
- PE
tags: 
- 导出表
---

# 目的
在程序正确运行的前提下，移动各种表
- 一个程序有很多PE文件组成
- 导出表记录函数、函数地址
- 一般情况下exe（大多数情况没用导出表，只用别人提供的函数）、dll都可以提供函数给其他函数用。

1. 可选PE头，数据目录项的第一个数据
2. RVA转化为FOA

```
typedef struct _IMAGE_EXPORT_DIRECTORY {
    DWORD   Characteristics;
    DWORD   TimeDateStamp;
    WORD    MajorVersion;
    WORD    MinorVersion;
    DWORD   Name;
    DWORD   Base;                //序号加
    DWORD   NumberOfFunctions;   //所有导出函数的个数
    DWORD   NumberOfNames;       //以函数名导出的函数的个数
    DWORD   AddressOfFunctions;     // RVA from base of image 函数地址
    DWORD   AddressOfNames;         // RVA from base of image 函数名称，叫这个名字的函数存在哪里
    DWORD   AddressOfNameOrdinals;  // RVA from base of image 函数序号
} IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY;
```

```
    DWORD   NumberOfFunctions;   //所有导出函数的个数 最大序号-最小序号-1
    DWORD   NumberOfNames;       //以函数名导出的函数的个数
    这两个地址可以不一般大，一位可以两个函数名指向同一个地址

    AddressOfFunctions 长度由NumberOfFunctions 决定
    AddressOfNames和AddressOfNameOrdinals 长度由NumberOfNames决定
```
`hmodule`就是PE在内存中拉伸后的数据

# 作业
1. 打印所有导出表信息
2. GetFunctionAddrByName(FileBuffer指针,函数名指针)
3. GetFunctionAddrByName(FileBuffer指针,函数名导出序号)