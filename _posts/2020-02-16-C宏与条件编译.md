---
title: C宏与条件编译
date: 2020-2-16
categories: 
- C基础
tags: 
- 宏
- 条件编译
---

# 宏定义
## 简介
1. 用一个标志符代表一个字符串。该标志符就称为宏名
2. 在程序编译预处理阶段，所有红名将会被替换为宏定义中的字符串，这个操作叫做宏展开
3. #define 宏名 字符串
4. #define 宏名(参数表) 字符串
5. 宏名大写
6. a.c (预处理) a.i (编译) a.s (汇编) a.o (链接) a.exe

```c
#include<stdio.h>

#define PI 3.14f
void Test()
{
	printf("%f", PI * 2 * 2);
}

int main(void)
{
	Test();
}
```

1. 有意义
2. 减少修改
3. 无类型检查
4. 无法调试
5. 宏 不是变量，没有类型，也无法调试

```c
const float PI = 3.14f
```
1. 有意义
2. 减少修改
3. 有类型
4. 可调式

```c
#include<stdio.h>

#define MAX(x,y) x>y?x:y

void Test()
{
	printf("%d\n", MAX(2, 3));
	printf("%d\n", MAX(1 & 7, 5 - 1));
    //宏展开是原封不动的展开。  1&7>5-1?1&7:5-1  --> 1&7>4?1:4 --> 1&1?1:4
}

int main(void)
{
	Test();
}

3
1

#include<stdio.h>

#define MAX(x,y) (x)>(y)?(x):(y)

void Test()
{
	printf("%d\n", MAX(2, 3));
	printf("%d\n", MAX(1 & 7, 5 - 1));
}

int main(void)
{
	Test();
}
```

## 带参数的宏与函数的优缺点比较
1. 宏的效率更高（inline），没有了函数调用过程中的进栈、传参、拷贝、出栈、堆栈平衡等问题
2. 宏是不用调试的
3. 宏无法进行类型检查
4. 传参的计算也不同，宏是简单地替换，函数是先计算在替换。

# 宏的应用及注意事项


# 作业
1. 定义一个宏计算数组长度

`#define ARRLEN(arr,type) sizeof(arr) / sizeof(type)`

2. 定义一个宏交换两个数

```c
#include<stdio.h>

#define swap(a,b) {t=a;a=b;b=t;}//宏定义，交换 

int main()
{
	int a, b, t;
	printf("输入两个数：\n");
	scanf("%d%d", &a, &b);//输入 
	printf("输出结果：\n");
	swap(a, b);//两个数进行交换 
	printf("%d %d", a, b);//输出 
}

#include<stdio.h>
//宏定义，交换 
#define swap(a,b) \
	do{\
		int temp; \
		temp = a; \
		a = b; \
		b = temp;\
	} while (0)


int main()
{
	int a, b, t;
	printf("输入两个数：\n");
	scanf("%d%d", &a, &b);//输入 
	printf("输出结果：\n");
	swap(a, b);//两个数进行交换 
	printf("%d %d", a, b);//输出 
}



```