---
title: C内存分配
date: 2020-2-10
categories: 
- C
tags: 
- 内存分配
---

# 内存分配与寻址

## 系统虚拟内存空间分布
  1. x86支持32位寻址，也就是2**32 = 4GB内存空间，高2G内核空间，
  2. 0x00000000-0x0000ffff 64KB NULL空间
  3. 0x0000ffff-0x7fff0000 进程空间
  4. 0x7fff0000-0x7fffffff 64KB非法区域
  5. 0x7fffffff-0xffffffff 2GB内核空间
  6. x86可以通过PAE技术，将寻址空间调整到64GB，36位寻址
  7. x64 windows用44位，linux用48位

## 程序内存分布
### 内存分类
1. 堆（heap）
   - malloc free 地址由低到高
   - 大小受限于计算机系统中有效的虚拟内存
   - 运行速度较慢而且容易产生内存碎片
   - 一般在堆的头部用一个字节存放堆得大小，剩余部分存储的内容由开发人员根据程序计算的需求决定
2. 栈（stack）
   - 系统自动分配回收，增长由高到低
   - 应用层1M到10M。内核层12K到24K不等
   - 系统自动分配，效率较高，但开发人员无法控制
   - 栈是用来记录程序执行时函数调用过程中的活动记录（栈针），参数，返回地址，ebp，局部变量等。
3. 静态区
4. 代码区

    ```c
    .rdata 常量
    .data 数据
    ```

    ![内存分类](/images/cc/内存分类.PNG)