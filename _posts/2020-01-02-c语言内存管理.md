---
title: C语言内存管理
date: 2020-1-2
categories: 
- C
- 内存管理
tags: 
- 内存管理
---

# 系统虚拟空间分布
- 0x00000000-0x7ffffff 其中最开始有64KB的NULL空间（0x00000000-0x0000ffff）
- 可以通过PAE技术扩展到64位（win一般是44位16TB、lin 48位）

# 程序内存布局
1. 堆
2. 栈（从高地址到低地址）
3. 静态区
4. 代码区

## 堆和栈的区别
### 内存分配
1. 栈：有系统自动分配与回收，int b = 0;增长由高到低
2. 堆：malloc、free 地址由低到高
### 大小限制
1. 栈：应用层1M-10M，内核层12K-24K
2. 堆：受限于计算机系统有效的虚拟内存
### 效率比较
1. 栈：系统自动分配，速度快，但程序员无法控制
2. 堆：速度较慢，而且容易产生碎片
### 存放内容
1. 栈：用来记录程序执行时函数调用过程中的活动记录（栈针），参数、返回地址、ebp、局部变量
2. 堆：一般在堆的头部用一个字节存放堆的大小，剩余部分存储的内容由程序员根据成计算的需要决定

## 内存地址分类
1. 逻辑地址

    由编译器生成，使用c语言指针时，指针的值就是逻辑地址。对于每一个进程而言，他们都有一样的进程空间，类似的逻辑地址，甚至可能相同。逻辑地址由段地址+段内偏移组成
2. 线性地址

    由分段基址将逻辑地址转化而来
3. 物理地址
## 寻址模式
1. 实模式分段模型
2. 保护模式扁平模型